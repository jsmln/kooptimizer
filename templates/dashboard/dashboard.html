{% extends "base.html" %}
{% load static %}

{% block title %}{% block dashboard_title %}Dashboard{% endblock %} - KoopTimizer{% endblock %}

{% block extra_head %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'frontend/dashboard.css' %}">
{% endblock %}

{% block header %}{% endblock %}
{% block footer %}{% endblock %}

{% block main_body %}
<div class="dashboard-layout">

    <nav class="sidebar">
        <div class="logo-area">
            <img src="{% static 'frontend/images/Logo.png' %}" alt="Logo" class="sidebar-logo">
            <h3>KoopTimizer</h3>
        </div>

        <ul class="nav-links">
            {% if request.session.role == 'admin' %}
                <li><a href="{% url 'dashboard:admin_dashboard' %}" class="nav-item active"><i class="bi bi-grid-fill"></i> Dashboard</a></li>
            {% elif request.session.role == 'staff' %}
                <li><a href="{% url 'dashboard:staff_dashboard' %}" class="nav-item active"><i class="bi bi-grid-fill"></i> Dashboard</a></li>
            {% elif request.session.role == 'officer' %}
                <li><a href="{% url 'dashboard:cooperative_dashboard' %}" class="nav-item active"><i class="bi bi-grid-fill"></i> Dashboard</a></li>
            {% endif %}

            <li class="nav-section-title">Modules</li>

            {% if request.session.role == 'admin' or request.session.role == 'staff' %}
                <li><a href="{% url 'account_management:account_management' %}" class="nav-item"><i class="bi bi-people-fill"></i> Accounts</a></li>
                <li><a href="{% url 'databank:databank_management' %}" class="nav-item"><i class="bi bi-database-fill"></i> Data Bank</a></li>
            {% endif %}

            {% if request.session.role == 'officer' %}
                <li><a href="{% url 'cooperatives:profile_form' %}" class="nav-item"><i class="bi bi-building"></i> Profile</a></li>
            {% endif %}

            <li><a href="{% url 'communications:message' %}" class="nav-item"><i class="bi bi-chat-dots-fill"></i> Messages</a></li>
            <li><a href="{% url 'communications:announcement_form' %}" class="nav-item"><i class="bi bi-megaphone-fill"></i> Announcements</a></li>
        </ul>

        <div class="sidebar-widgets">
            
            <div class="mini-widget">
                <h4>Calendar <i class="bi bi-calendar4-week"></i></h4>
                <div class="mini-calendar-box">
                    <div class="mini-date">{% now "M d" %}</div>
                    <div class="mini-day">{% now "l" %}</div>
                </div>
            </div>

            <div class="mini-widget">
                <h4>Activity</h4>
                <div class="mini-activity-list">
                    <div class="mini-activity-item">
                        <div class="mini-activity-text">
                            <strong>New Message</strong>
                            <span>Just now</span>
                        </div>
                    </div>
                    <div class="mini-activity-item">
                        <div class="mini-activity-text">
                            <strong>System Update</strong>
                            <span>2h ago</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        
        <button id="sidebar-close-btn" class="d-md-none sidebar-close"><i class="bi bi-x-lg"></i></button>
    </nav>

    <main class="main-content-wrapper">
        
        <header class="top-bar">
            <div class="top-left">
                <button id="sidebar-toggle-btn" class="d-md-none"><i class="bi bi-list"></i></button>
                <div class="page-title">{% block page_header %}Dashboard Overview{% endblock %}</div>
            </div>
            
            <div class="search-box">
                <i class="bi bi-search"></i>
                <input type="text" placeholder="Search...">
            </div>

            <div class="user-menu">
                <div class="user-info">
                    <span class="u-name">{{ request.session.username }}</span>
                    <span class="u-role">{{ request.session.role|capfirst }}</span>
                </div>
                <div class="avatar">
                    {{ request.session.username|first|upper }}
                </div>
                <a href="#" data-bs-toggle="modal" data-bs-target="#logoutModal" class="logout-btn-mini" title="Logout">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </header>

        <div class="content-scrollable">
            {% block dashboard_content %}
                <div class="welcome-banner">
                    <h2>Welcome back, {{ request.session.username }}!</h2>
                    <p>Here is what's happening with your cooperative today.</p>
                </div>
            {% endblock %}
        </div>
    </main>

</div>

<div class="sidebar-overlay"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const toggleBtn = document.getElementById('sidebar-toggle-btn');
        const closeBtn = document.getElementById('sidebar-close-btn');
        const overlay = document.querySelector('.sidebar-overlay');
        const body = document.body;

        function toggleSidebar() {
            body.classList.toggle('sidebar-open');
        }

        if(toggleBtn) toggleBtn.addEventListener('click', toggleSidebar);
        if(closeBtn) closeBtn.addEventListener('click', toggleSidebar);
        if(overlay) overlay.addEventListener('click', toggleSidebar);
    });
</script>
{% endblock %}