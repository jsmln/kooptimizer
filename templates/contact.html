{% extends "base.html" %}
{% load static %}

{% block title %}Contact Us - KoopTimizer{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'frontend/contact.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
{% endblock %}

{% block content %}
<script src="https://www.google.com/recaptcha/api.js" async defer></script>
<div class="card shadow-sm" style="background-color: white; border: none; border-radius: 20px; max-width: 1200px; margin: 80px auto; padding: 20px;">
    <div class="card-body p-0">
        <div class="contact-wrapper" style="margin: 0; padding: 0;">
    
    <div class="contact-info-column">
        
        <div class="info-card">
            <div class="icon-box">
                <i class="bi bi-envelope"></i>
            </div>
            <div class="card-content">
                <h3>Contact Sales</h3>
                <p>We are delighted to discuss how we can work together.</p>
                <p>
                    <strong>Email:</strong> kooptimizer@gmail.com<br>
                    <strong>Social:</strong> Kooptimizer<br>
                    <strong>Phone:</strong> +63 9929380935
                </p>
            </div>
        </div>

        <div class="info-card">
            <div class="icon-box">
                <i class="bi bi-headset"></i>
            </div>
            <div class="card-content">
                <h3>Technical Support</h3>
                <p>We're here to help with any questions you may have.</p>
                <a href="#" class="contact-link">Contact Support →</a>
            </div>
        </div>

        <div class="info-card">
            <div class="icon-box">
                <i class="bi bi-chat-dots"></i>
            </div>
            <div class="card-content">
                <h3>Chat with us</h3>
                <p>Chat with our sales and support teams to get a quick response.</p>
                <a href="#" class="contact-link">Start a Conversation →</a>
            </div>
        </div>
    </div>

    <div class="contact-form-column">
        <h2>Send Us Your Message</h2>

        {% if messages %}
            <div class="messages-container" style="margin-bottom: 20px;">
            {% for message in messages %}
                <div class="alert alert-dismissible fade show {% if message.tags == 'success' %}alert-success{% elif message.tags == 'error' %}alert-danger{% else %}alert-info{% endif %}" role="alert" style="border-radius: 8px; padding: 15px; display: flex; align-items: center; gap: 10px;">
                    {% if message.tags == 'success' %}
                        <i class="bi bi-check-circle-fill" style="font-size: 20px;"></i>
                    {% elif message.tags == 'error' %}
                        <i class="bi bi-exclamation-triangle-fill" style="font-size: 20px;"></i>
                    {% else %}
                        <i class="bi bi-info-circle-fill" style="font-size: 20px;"></i>
                    {% endif %}
                    <span style="flex: 1;">{{ message }}</span>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
            </div>
        {% endif %}

        <form method="POST">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="name">Name <span>*</span></label>
                <input type="text" id="name" name="name" class="form-control" placeholder="Enter your name" required>
            </div>

            <div class="form-group">
                <label for="email">Email <span>*</span></label>
                <input type="email" id="email" name="email" class="form-control" placeholder="Enter your email" required>
            </div>

            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="text" id="phone" name="phone" class="form-control" placeholder="Enter your phone number">
            </div>

            <div class="form-group">
                <label for="subject">Subject <span>*</span></label>
                <input type="text" id="subject" name="subject" class="form-control" placeholder="Summarize your request briefly" required>
            </div>

            <div class="form-group">
                <label for="message">How can we help? <span>*</span></label>
                <textarea id="message" name="message" class="form-control" placeholder="Provide details about your request" required></textarea>
            </div>

            <div class="form-group" style="display: flex; justify-content: center; margin: 20px 0;">
                <div id="recaptcha-placeholder" class="g-recaptcha" data-sitekey="6LeepvErAAAAAP3XNLdmBipdELXOuZqfo13T6lYE">
                </div>
            </div>

            <button type="submit" class="btn-submit" id="submit-btn">
                <span class="btn-text">Submit</span>
                <span class="btn-loading" style="display: none;">
                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    Sending...
                </span>
            </button>

            <p class="legal-text">
                By clicking submit, you agree to our <a href="#">Privacy policy</a> and <a href="#">terms</a>.
            </p>
        </form>
    </div>

        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.querySelector('form');
    const submitBtn = document.getElementById('submit-btn');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    
    let isSubmitting = false;

    contactForm.addEventListener('submit', function(e) {
        // Prevent double submission
        if (isSubmitting) {
            e.preventDefault();
            return false;
        }
        
        isSubmitting = true;
        
        // Show loading state
        btnText.style.display = 'none';
        btnLoading.style.display = 'inline-block';
        submitBtn.disabled = true;
        
        // Failsafe: Reset after 10 seconds if something goes wrong
        setTimeout(function() {
            if (isSubmitting) {
                resetButton();
            }
        }, 10000);
    });
    
    function resetButton() {
        isSubmitting = false;
        btnText.style.display = 'inline-block';
        btnLoading.style.display = 'none';
        submitBtn.disabled = false;
    }
    
    // Reset button on page show (back button, etc.)
    window.addEventListener('pageshow', function(e) {
        resetButton();
    });

    // Auto-dismiss alerts after 5 seconds
    const alerts = document.querySelectorAll('.alert');
    alerts.forEach(function(alert) {
        setTimeout(function() {
            const bsAlert = new bootstrap.Alert(alert);
            bsAlert.close();
        }, 5000);
    });
});
</script>
{% endblock %}